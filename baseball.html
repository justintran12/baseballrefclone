<!DOCTYPE html>
<html>
<head>
<title>Baseball Reference Clone</title>
<meta charset="UTF-8"> <meta name="description" content="This field contains information about your page. It is usually around two sentences long."> <meta name="author" content="Conor Sheils">
<h1>Player Stats</h1>
<p id="getDataResponse"></p>
</head>
<body>
<div>
	<label for="player_name">Enter Position Player Name:</label> <br>
	<input type="text" id="player_name" name="player_name"> <br>
	<button onclick = "getData('hitting')" > Submit </button> <br>
</div>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<div>
	<p> Hitter Stats</p>
	<table id = 'statsTable'>
		<thead>
			<tr>
				<th>Year</th>
				<th>GP</th>
				<th>PA</th>
				<th>AB</th>
				<th>BB</th>
				<th>Hits</th>
				<th>2B</th>
				<th>3B</th>
				<th>HR</th>
				<th>AVG</th>
				<th>OBP</th>
				<th>SLG</th>
				<th>OPS</th>
				<th>RBI</th>
				<th>Runs</th>
				<th>SO</th>
				<th>SB</th>
				<th>BABIP</th>
				<th>HBP</th>
			</tr>
		</thead>
	</table>
</div>
<div>
	<label for="pitcher_name">Enter Pitcher Name:</label> <br>
	<input type="text" id="pitcher_name" name="pitcher_name"> <br>
	<button onclick = "getData('pitching')" > Submit </button> <br>
</div>
<div>
	<p> Pitcher Stats</p>
	<table id = 'pitcherStatsTable'>
		<thead>
			<tr>
				<th>Year</th>
				<th>Starts</th>
				<th>GP</th>
				<th>IP</th>
				<th>W</th>
				<th>L</th>
				<th>ERA</th>
				<th>Opp. Avg</th>
				<th>WHIP</th>
				<th>SO</th>
				<th>BB</th>
				<th>Hits</th>
				<th>HR</th>
				<th>Strike %</th>
				<th>Saves</th>
				<th>Save Opps</th>
				<th>CG</th>
				<th>Shut Outs</th>
				<th>Wild Pitches</th>
			</tr>
		</thead>
	</table>
</div>
<div>
	<h1>Player Ranking</h1>
	<p id = playerRanks> </p>
</div>
<div>
	<h1> League Leaders</h1> <br>
	<h2> Pitching </h2> <br>
	<p> ERA </p>
	<table id = 'eraLeader'>
		<thead>
			<tr>
				<th>Rank</th>
				<th>Name</th>
				<th>Team</th>
				<th>Value</th>
			</tr>
		</thead>
	</table>
	<p> WHIP </p>
	<table id = 'whipLeader'>
		<thead>
			<tr>
				<th>Rank</th>
				<th>Name</th>
				<th>Team</th>
				<th>Value</th>
			</tr>
		</thead>
	</table>
	<p> SO </p>
	<table id = 'soLeader'>
		<thead>
			<tr>
				<th>Rank</th>
				<th>Name</th>
				<th>Team</th>
				<th>Value</th>
			</tr>
		</thead>
	</table>
	<p> IP </p>
	<table id = 'ipLeader'>
		<thead>
			<tr>
				<th>Rank</th>
				<th>Name</th>
				<th>Team</th>
				<th>Value</th>
			</tr>
		</thead>
	</table> 
	<br>
	<h2> Hitting  </h2>
	<p> Avg </p>
	<table id = 'avgLeader'>
		<thead>
			<tr>
				<th>Rank</th>
				<th>Name</th>
				<th>Team</th>
				<th>Value</th>
			</tr>
		</thead>
	</table>
	<p> OBP</p>
	<table id = 'obpLeader'>
		<thead>
			<tr>
				<th>Rank</th>
				<th>Name</th>
				<th>Team</th>
				<th>Value</th>
			</tr>
		</thead>
	</table>
	<p> SLG </p>
	<table id = 'slgLeader'>
		<thead>
			<tr>
				<th>Rank</th>
				<th>Name</th>
				<th>Team</th>
				<th>Value</th>
			</tr>
		</thead>
	</table>
	<p> OPS </p>
	<table id = 'opsLeader'>
		<thead>
			<tr>
				<th>Rank</th>
				<th>Name</th>
				<th>Team</th>
				<th>Value</th>
			</tr>
		</thead>
	</table>
	<p> Hits </p>
	<table id = 'hitsLeader'>
		<thead>
			<tr>
				<th>Rank</th>
				<th>Name</th>
				<th>Team</th>
				<th>Value</th>
			</tr>
		</thead>
	</table>
	<p> HR </p>
	<table id = 'hrLeader'>
		<thead>
			<tr>
				<th>Rank</th>
				<th>Name</th>
				<th>Team</th>
				<th>Value</th>
			</tr>
		</thead>
	</table>
	<p> RBI</p>
	<table id = 'rbiLeader'>
		<thead>
			<tr>
				<th>Rank</th>
				<th>Name</th>
				<th>Team</th>
				<th>Value</th>
			</tr>
		</thead>
	</table>
	<p> SB </p>
	<table id = 'sbLeader'>
		<thead>
			<tr>
				<th>Rank</th>
				<th>Name</th>
				<th>Team</th>
				<th>Value</th>
			</tr>
		</thead>
	</table>
</div>
<script>
var leagueLeaders;
function dataToHTML (map, year) {
	const GP = map.get("gamesPlayed");
	const PA = map.get("plateAppearances");
	const AB = map.get("atBats");
	const BB = map.get("baseOnBalls");
	const Hits = map.get("hits");
	const Doubles = map.get("doubles");
	const Triples = map.get("triples");
	const HR = map.get("homeRuns");
	const AVG = map.get("avg");
	const OBP = map.get("obp");
	const SLG = map.get("slg");
	const OPS = map.get("ops");
	const RBI = map.get("rbi");
	const Runs = map.get("runs");
	const SO = map.get("strikeOuts");
	const SB = map.get("stolenBases");
	const BABIP = map.get("babip");
	const HBP = map.get("hitByPitch");
	//const htmlDataStr = ("<tr> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> </tr>", GP, PA, AB, BB, Hits, Doubles, Triples, HR, AVG, OBP, SLG, OPS, RBI, Runs, SO, SB, BABIP, HBP);
	const htmlDataStr = `<tr> <td> ${year} </td> <td> ${GP} </td> <td> ${PA} </td> <td> ${AB} </td> <td> ${BB} </td> <td> ${Hits} </td> <td> ${Doubles} </td> <td> ${Triples} </td> <td> ${HR} </td> <td> ${AVG} </td> <td> ${OBP} </td> <td> ${SLG} </td> <td> ${OPS} </td> <td> ${RBI} </td> <td> ${Runs} </td> <td> ${SO} </td> <td> ${SB} </td> <td> ${BABIP} </td> <td> ${HBP} </td> </tr>`;
	return htmlDataStr;	
}
function pitcherDataToHTML (map, year) {
	const starts = map.get("gamesStarted")
	const GP = map.get("gamesPlayed");
	const IP = map.get("inningsPitched");
	const W = map.get("wins");
	const L = map.get("losses");
	const ERA = map.get("era");
	const oppAvg = map.get("avg");
	const whip = map.get("whip");
	const SO = map.get("strikeOuts");
	const BB = map.get("baseOnBalls");
	const hits = map.get("hits");
	const HR = map.get("homeRuns");
	const strikeP = map.get("strikePercentage");
	const saves = map.get("saves");
	const saveOpps = map.get("saveOpportunities");
	const CG = map.get("completeGames");
	const shutOuts = map.get("shutouts");
	const wildPitches = map.get("wildPitches");
	const htmlDataStr = `<tr> <td> ${year} </td> <td> ${starts} </td> <td> ${GP} </td> <td> ${IP} </td> <td> ${W} </td> <td> ${L} </td> <td> ${ERA} </td> <td> ${oppAvg} </td> <td> ${whip} </td> <td> ${SO} </td> <td> ${BB} </td> <td> ${hits} </td> <td> ${HR} </td> <td> ${strikeP} </td> <td> ${saves} </td> <td> ${saveOpps} </td> <td> ${CG} </td> <td> ${shutOuts} </td> <td> ${wildPitches} </td> </tr>`;
	return htmlDataStr;	
}
function leaderDataToHTML(data) {
	const rank = data[0][0];
	const name = data[0][1];
	const team = data[0][2];
	const value = data[0][3];
	const htmlDataStr = `<tr> <td> ${rank} </td> <td> ${name} </td> <td> ${team} </td> <td> ${value} </td> </tr>`;
	return htmlDataStr;
}
function rankToMap(leadersData, player, playerRanks, stat) {
	for (let i = 0; i < leadersData.length; i++) {
		if (player == leadersData[i][1]) {
			let rank = leadersData[i][0];
			let data = [rank, leadersData.length]
			playerRanks.set(stat, data);
			break;
		}
	}
}
function checkPitcherRank(player) {
	let playerRanks = new Map();
	for (const key of leagueLeaders.keys()) {
		var leadersData = leagueLeaders.get(key);
		if (key == "ERA") {
			rankToMap(leadersData, player, playerRanks, "ERA");
		} else if (key == "WHIP") {
			rankToMap(leadersData, player, playerRanks, "WHIP");
		} else if (key == "SO") {
			rankToMap(leadersData, player, playerRanks, "SO");
		} else if (key == "IP") {
			rankToMap(leadersData, player, playerRanks, "IP");
		}
	}
	return playerRanks;
}
function checkPositionPlayerRank(player) {
	let playerRanks = new Map();
	for (const key of leagueLeaders.keys()) {
		var leadersData = leagueLeaders.get(key);
		if (key == "BA") {
			rankToMap(leadersData, player, playerRanks, "BA");
		} else if (key == "OBP") {
			rankToMap(leadersData, player, playerRanks, "OBP");
		} else if (key == "SLG") {
			rankToMap(leadersData, player, playerRanks, "SLG");
		} else if (key == "OPS") {
			rankToMap(leadersData, player, playerRanks, "OPS");
		} else if (key == "Hits") {
			rankToMap(leadersData, player, playerRanks, "Hits");
		} else if (key == "HR") {
			rankToMap(leadersData, player, playerRanks, "HR");
		} else if (key == "SB") {
			rankToMap(leadersData, player, playerRanks, "SB");
		} else if (key == "RBI") {
			rankToMap(leadersData, player, playerRanks, "RBI");
		}
	}
	return playerRanks;
}
function ranksToString(playerRankMap, player) {
	if (playerRankMap.size == 0) {
		return player + " is not qualified to be ranked in any statistic";
	} 
	let rankStr = player + " is ranked: ";
	const keys = Array.from(playerRankMap.keys());
	for (let i = 0; i < keys.length - 1; i++) {
		let data = playerRankMap.get(keys[i]);
		let rank = data[0];
		let total = data[1];
		if (rank <= 10) {
			rankStr += "<b>" + rank + " out of " + total + " in " + keys[i] + "</b>, ";
		} else {
			rankStr += rank + " out of " + total + " in " + keys[i] + ", ";
		}
	}
	let lastStat = keys[keys.length - 1];
	let lastData = playerRankMap.get(lastStat);
	let lastRank = lastData[0];
	let lastTotal = lastData[1];
	if (lastRank <= 10) {
		rankStr += "<b>" + lastRank + " out of " + lastTotal + " in " + lastStat + "</b>";
	} else {
		rankStr += lastRank + " out of " + lastTotal + " in " + lastStat;
	}
	return rankStr;
}
function getData(player_type) {
	$("#statsTable").find("tr:gt(0)").remove();
	$("#pitcherStatsTable").find("tr:gt(0)").remove();
	if (player_type == "hitting") {
		var playerNameInput = document.getElementById("player_name").value;
		var playerRanks = checkPositionPlayerRank(playerNameInput);
		document.getElementById("playerRanks").innerHTML = ranksToString(playerRanks, playerNameInput);
	} else {
		var playerNameInput = document.getElementById("pitcher_name").value;
		var playerRanks = checkPitcherRank(playerNameInput);
		document.getElementById("playerRanks").innerHTML = ranksToString(playerRanks, playerNameInput);
	}
	$.ajax({
		type: 'get',
		url: 'http://127.0.0.1:5000/career',
		data: {'player_name':playerNameInput, 'player_type':player_type},
		dataType: 'json',
		success: function (data) {
			const data2 = JSON.stringify(data);
			const map = new Map(Object.entries(JSON.parse(data2)));
			
			if (player_type == "hitting") {
				statsTable = document.getElementById('statsTable');
				statsTable.innerHTML += dataToHTML(map, 'Career');
			} else {
				statsTable = document.getElementById('pitcherStatsTable');
				statsTable.innerHTML += pitcherDataToHTML(map, 'Career');
			}
			
			document.getElementById("getDataResponse").innerHTML = "Success, found player!"
		},
		error: function (error) {
			document.getElementById("getDataResponse").innerHTML = "Error player not found, player may be inactive or you misspelled the name"
			console.log(`Error ${error}`);
		}
	});
	$.ajax({
		type: 'get',
		url: 'http://127.0.0.1:5000/seasons',
		data: {'player_name':playerNameInput, 'player_type':player_type},
		dataType: 'json',
		success: function (data) {
			const data2 = JSON.stringify(data);
			const map = new Map(Object.entries(JSON.parse(data2)));
			
			if (player_type == "hitting") {
				statsTable = document.getElementById('statsTable');
			} else {
				statsTable = document.getElementById('pitcherStatsTable');
			}

			for (const key of map.keys()){
				var value = new Map(Object.entries(map.get(key)));
				if (player_type == "hitting") {
					statsTable.innerHTML += dataToHTML(value, key);
				} else {
					statsTable.innerHTML += pitcherDataToHTML(value, key);
				}
			}
		},
		error: function (error) {
			console.log(`Error ${error}`);
		}
	});
}
$.ajax({
		type: 'get',
		url: 'http://127.0.0.1:5000/leaders',
		success: function (data) {
			const data2 = JSON.stringify(data);
			leagueLeaders = new Map(Object.entries(JSON.parse(data2)));

			for (const key of leagueLeaders.keys()){
				var value = leagueLeaders.get(key);
				if (key == "ERA") {
					document.getElementById("eraLeader").innerHTML += leaderDataToHTML(value);
				} else if (key == "WHIP") {
					document.getElementById("whipLeader").innerHTML += leaderDataToHTML(value);
				} else if (key == "SO") {
					document.getElementById("soLeader").innerHTML += leaderDataToHTML(value);
				} else if (key == "IP") {
					document.getElementById("ipLeader").innerHTML += leaderDataToHTML(value);
				} else if (key == "BA") {
					document.getElementById("avgLeader").innerHTML += leaderDataToHTML(value);
				} else if (key == "OBP") {
					document.getElementById("obpLeader").innerHTML += leaderDataToHTML(value);
				} else if (key == "SLG") {
					document.getElementById("slgLeader").innerHTML += leaderDataToHTML(value);
				} else if (key == "OPS") {
					document.getElementById("opsLeader").innerHTML += leaderDataToHTML(value);
				} else if (key == "Hits") {
					document.getElementById("hitsLeader").innerHTML += leaderDataToHTML(value);
				} else if (key == "HR") {
					document.getElementById("hrLeader").innerHTML += leaderDataToHTML(value);
				} else if (key == "SB") {
					document.getElementById("sbLeader").innerHTML += leaderDataToHTML(value);
				} else { // RBI
					document.getElementById("rbiLeader").innerHTML += leaderDataToHTML(value);
				} 
			}
		},
		error: function (error) {
			console.log(`Error ${error}`);
		}
	});
</script>
</body>
</html>