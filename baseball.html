<!DOCTYPE html>
<html>
<head>
<title>Baseball Reference Clone</title>
<meta charset="UTF-8"> <meta name="description" content="This field contains information about your page. It is usually around two sentences long."> <meta name="author" content="Conor Sheils">
<h1>Player Stats</h1>
</head>
<body>
<div>
	<label for="player_name">Enter Position Player Name:</label> <br>
	<input type="text" id="player_name" name="player_name"> <br>
	<button onclick = "getData()" > Submit </button>
	<p id="getDataResponse"></p>
</div>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<table id = 'statsTable'>
	<thead>
		<tr>
			<th>Year</th>
			<th>GP</th>
			<th>PA</th>
			<th>AB</th>
			<th>BB</th>
			<th>Hits</th>
			<th>2B</th>
			<th>3B</th>
			<th>HR</th>
			<th>AVG</th>
			<th>OBP</th>
			<th>SLG</th>
			<th>OPS</th>
			<th>RBI</th>
			<th>Runs</th>
			<th>SO</th>
			<th>SB</th>
			<th>BABIP</th>
			<th>HBP</th>
		</tr>
	</thead>
</table>
<script>
function dataToHTML (map, year) {
	const GP = map.get("gamesPlayed");
	const PA = map.get("plateAppearances");
	const AB = map.get("atBats");
	const BB = map.get("baseOnBalls");
	const Hits = map.get("hits");
	const Doubles = map.get("doubles");
	const Triples = map.get("triples");
	const HR = map.get("homeRuns");
	const AVG = map.get("avg");
	const OBP = map.get("obp");
	const SLG = map.get("slg");
	const OPS = map.get("ops");
	const RBI = map.get("rbi");
	const Runs = map.get("runs");
	const SO = map.get("strikeOuts");
	const SB = map.get("stolenBases");
	const BABIP = map.get("babip");
	const HBP = map.get("hitByPitch");
	//const htmlDataStr = ("<tr> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> <td> %s </td> </tr>", GP, PA, AB, BB, Hits, Doubles, Triples, HR, AVG, OBP, SLG, OPS, RBI, Runs, SO, SB, BABIP, HBP);
	const htmlDataStr = `<tr> <td> ${year} </td> <td> ${GP} </td> <td> ${PA} </td> <td> ${AB} </td> <td> ${BB} </td> <td> ${Hits} </td> <td> ${Doubles} </td> <td> ${Triples} </td> <td> ${HR} </td> <td> ${AVG} </td> <td> ${OBP} </td> <td> ${SLG} </td> <td> ${OPS} </td> <td> ${RBI} </td> <td> ${Runs} </td> <td> ${SO} </td> <td> ${SB} </td> <td> ${BABIP} </td> <td> ${HBP} </td> </tr>`;
	return htmlDataStr;	
}
function getData() {
	$("#statsTable").find("tr:gt(0)").remove();
	var playerNameInput = document.getElementById("player_name").value;
	$.ajax({
		type: 'get',
		url: 'http://127.0.0.1:5000/career',
		data: {'player_name':playerNameInput},
		dataType: 'json',
		success: function (data) {
			const data2 = JSON.stringify(data);
			const map = new Map(Object.entries(JSON.parse(data2)));

			statsTable = document.getElementById('statsTable');
			statsTable.innerHTML += dataToHTML(map, 'Career');
			document.getElementById("getDataResponse").innerHTML = "Success, found player!"
		},
		error: function (error) {
			document.getElementById("getDataResponse").innerHTML = "Error player not found, player may be inactive or you misspelled the name"
			console.log(`Error ${error}`);
		}
	});
	$.ajax({
		type: 'get',
		url: 'http://127.0.0.1:5000/seasons',
		data: {'player_name':playerNameInput},
		dataType: 'json',
		success: function (data) {
			const data2 = JSON.stringify(data);
			const map = new Map(Object.entries(JSON.parse(data2)));
			
			statsTable = document.getElementById('statsTable');
			for (const key of map.keys()){
				var value = new Map(Object.entries(map.get(key)));
				statsTable.innerHTML += dataToHTML(value, key);
			}
		},
		error: function (error) {
			console.log(`Error ${error}`);
		}
	});
}
</script>
</body>
</html>